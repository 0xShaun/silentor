!function(t){"use strict";function e(t){return-1!==t.indexOf("//")}function i(t){return t.slice(0,t.lastIndexOf("/")+1)}function n(t){return-1!==t.toLowerCase().indexOf(".md")||-1!==t.toLowerCase().indexOf(".markdown")}function a(e,i){t(window).trigger(e,i)}function r(t,e){"/"==t[t.length-1]&&(t=t.substring(0,t.length-1));var i=t.split("/"),n=e.split("/");if("."==n[0])n.splice(0,1);else{if(".."!=n[0])return-1!=n[0].indexOf("http")||-1!=n[0].indexOf("https")?e:i.join("/")+"/"+n.join("/");i.splice(i.length-1,1),n.splice(0,1)}return r(i.join("/"),n.join("/"))}function o(f,c,h,m){var m=m||d,h=h||!1,u=m+c;t.get(u,function(o){marked.setOptions({highlight:function(t){return hljs.highlightAuto(t).value}});var c=t(f);if(c.html(marked(o)),c.find("[href]").each(function(){var a=t(this),o=a.attr("href");if(e(o)&&a.attr("target","_blank"),h&&n(o)&&a.attr("href","?"+o),!e(o)&&!h&&n(o)){var f=i(g);0==o.indexOf("../")?f=r(i(g),o):0==o.indexOf("__P__")?f=o.replace("__P__/",""):f+=o.replace("./",""),a.attr("href","?"+f)}}),!h){var s=t("#main-page").find("h1, h2, h3, h4, h5, h6").first().text();t("title").text(s),t.each(c.find("img"),function(e,i){var n=t(i).attr("alt")||"";t(i).addClass(-1!=n.indexOf("|left")?"img-left":-1!=n.indexOf("|right")?"img-right":"img-center")})}h&&(c.find("img").first().addClass("avatar"),t.each(c.find("li"),function(e,i){t(i).addClass("sidebar-item")})),t.each(c.find("img"),function(e,n){var a=t(n);if(0==a.attr("src").indexOf("__IMG__"))a.attr("src",a.attr("src").replace("__IMG__",l));else{var o=r(i(u),a.attr("src"));a.attr("src",o)}}),"#sidebar-page"==f?a("loaded-sidebar-page"):"#main-page"==f?a("loaded-main-page"):"#main-page-footer"==f&&a("loaded-main-page-footer")}).fail(function(t){if(404===t.status){if("footer.md"===c)return void console.log("没有找到footer.md! 建议在p/目录下建立footer.md 文件来添加底部信息！");o("#main-page","404.md",!1,"/"+s+"/"),a("page-not-found",{selector:f,path:c})}})}function f(e){t.getJSON("config.json",{},function(i){s=i.app_name||s,l=i.img_root||l;var n=i.description||"";h=i.markdown_root||h,d="/"+s+"/"+h+"/",t("meta[name=description]").first().attr("content",n),e()}).fail(function(t){alert("读取配置有误")})}function c(){f(function(){o("#sidebar-page","sidebar.md",!0),o("#main-page-footer","footer.md"),g=-1!==location.search.indexOf("&")?location.search.slice(1,location.search.indexOf("&")):location.search.slice(1,location.search.length),"/"===g.charAt(g.length-1)&&(g=g.slice(0,location.search.length-2)),""!==g&&n(g)?o("#main-page",g):o("#main-page","home.md")})}var s="",d="",l="img",h="p",g="";c()}(jQuery);