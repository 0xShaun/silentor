!function(t){function e(t){return-1!==t.indexOf("//")}function i(t){return t.slice(0,t.lastIndexOf("/")+1)}function n(t){return-1!==t.toLowerCase().indexOf(".md")||-1!==t.toLowerCase().indexOf(".markdown")}function r(t,e){"/"==t[t.length-1]&&(t=t.substring(0,t.length-1));var i=t.split("/"),n=e.split("/");if("."==n[0])n.splice(0,1);else{if(".."!=n[0])return-1!=n[0].indexOf("http")||-1!=n[0].indexOf("https")?e:i.join("/")+"/"+n.join("/");i.splice(i.length-1,1),n.splice(0,1)}return r(i.join("/"),n.join("/"))}function a(o,f,d,u){u=u||s,d=d||!1,p_url=u+f,t.get(p_url,function(a){marked.setOptions({highlight:function(t){return hljs.highlightAuto(t).value}});var f=t(o);if(f.html(marked(a)),f.find("[href]").each(function(){var a=t(this),o=a.attr("href");if(e(o)&&a.attr("target","_blank"),d&&n(o)&&a.attr("href","?"+o),!e(o)&&!d&&n(o)){var f=i(h);0==o.indexOf("../")?f=r(i(h),o):0==o.indexOf("__P__")?f=o.replace("__P__/",""):f+=o.replace("./",""),a.attr("href","?"+f)}}),!d){var c=t("#main-page").find("h1, h2, h3, h4, h5, h6").first().text();t("title").text(c),t.each(f.find("img"),function(e,i){var n=t(i).attr("alt")||"";t(i).addClass(-1!=n.indexOf("|left")?"img-left":-1!=n.indexOf("|right")?"img-right":"img-center")})}d&&(f.find("img").first().addClass("avatar"),t.each(f.find("li"),function(e,i){t(i).addClass("sidebar-item")})),t.each(f.find("img"),function(e,n){if($e=t(n),0==$e.attr("src").indexOf("__IMG__"))$e.attr("src",$e.attr("src").replace("__IMG__",l));else{var a=r(i(p_url),$e.attr("src"));$e.attr("src",a)}})}).fail(function(t){if(404===t.status){if("footer.md"===f)return void console.log("没有找到footer.md! 建议在p/目录下建立footer.md 文件来添加底部信息！");a("#main-page","404.md",!1,"/"+c+"/")}})}function o(e){t.getJSON("config.json",{},function(i){c=i.app_name||c,l=i.img_root||l,description=i.description||"",d=i.markdown_root||d,s="/"+c+"/"+d+"/",t("meta[name=description]").first().attr("content",description),e()}).fail(function(t){alert("读取配置有误")})}function f(){o(function(){a("#sidebar-page","sidebar.md",!0),a("#main-page-footer","footer.md"),h=-1!==location.search.indexOf("&")?location.search.slice(1,location.search.indexOf("&")):location.search.slice(1,location.search.length),"/"===h.charAt(h.length-1)&&(h=h.slice(0,location.search.length-2)),""!==h&&n(h)?a("#main-page",h):a("#main-page","home.md")})}var c="",s="",l="img",d="p",h="";f()}(jQuery);